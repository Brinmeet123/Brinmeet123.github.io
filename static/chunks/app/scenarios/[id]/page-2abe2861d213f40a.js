(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[646],{8297:function(e,t,s){Promise.resolve().then(s.bind(s,8759))},8759:function(e,t,s){"use strict";s.d(t,{default:function(){return k}});var a=s(7437),i=s(2265);function r(e){let{patientName:t,onPatientClick:s}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Scene"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-around items-center gap-6",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"w-24 h-24 bg-primary-100 rounded-full flex items-center justify-center mb-2",children:(0,a.jsx)("span",{className:"text-4xl",children:"\uD83D\uDC68‍⚕️"})}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"You (Doctor)"})]}),(0,a.jsx)("div",{className:"text-2xl text-gray-400",children:"→"}),(0,a.jsxs)("button",{onClick:s,className:"flex flex-col items-center hover:opacity-80 transition-opacity cursor-pointer",children:[(0,a.jsx)("div",{className:"w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mb-2",children:(0,a.jsx)("span",{className:"text-4xl",children:"\uD83D\uDC64"})}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700",children:t}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"(Patient)"})]})]})]})}var n=s(8523);function l(e){let{text:t,viewMode:s="simple",onTermClick:r,onTermSave:l}=e,[o,d]=(0,i.useState)(null),[c,m]=(0,i.useState)(null),x=(0,i.useMemo)(()=>{let e=[],s=t.toLowerCase();return n.AS.forEach(t=>{let a;let i=t.term.toLowerCase(),r=RegExp("\\b".concat(i,"\\b"),"gi");for(;null!==(a=r.exec(s));){let s=a.index,r=s+i.length;e.some(e=>s>=e.startIndex&&s<e.endIndex||r>e.startIndex&&r<=e.endIndex||s<=e.startIndex&&r>=e.endIndex)||e.push({term:t,startIndex:a.index,endIndex:a.index+i.length})}}),e.sort((e,t)=>e.startIndex-t.startIndex)},[t]),u=(e,t)=>{e.preventDefault(),e.stopPropagation();let s=e.currentTarget.getBoundingClientRect();m({x:s.left+s.width/2,y:s.top-10}),d(t),r&&r(t.term)},p=()=>{d(null),m(null)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"vocab-text",children:(()=>{if(0===x.length)return(0,a.jsx)("span",{children:t});let e=[],s=0;return x.forEach((i,r)=>{i.startIndex>s&&e.push((0,a.jsx)("span",{children:t.substring(s,i.startIndex)},"text-".concat(r)));let n=t.substring(i.startIndex,i.endIndex);e.push((0,a.jsx)("button",{onClick:e=>u(e,i.term),className:"underline decoration-2 decoration-primary-500 text-primary-700 hover:text-primary-900 hover:bg-primary-50 px-1 rounded transition cursor-pointer",title:"Click to learn about ".concat(i.term.display),children:n},"term-".concat(r))),s=i.endIndex}),s<t.length&&e.push((0,a.jsx)("span",{children:t.substring(s)},"text-end")),(0,a.jsx)(a.Fragment,{children:e})})()}),o&&c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-40",onClick:p}),(0,a.jsxs)("div",{className:"fixed z-50 bg-white rounded-lg shadow-xl border-2 border-primary-200 p-4 max-w-sm",style:{left:"".concat(c.x,"px"),top:"".concat(c.y,"px"),transform:"translate(-50%, calc(-100% - 10px))"},onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsx)("h4",{className:"font-bold text-lg text-primary-900",children:o.display}),(0,a.jsx)("button",{onClick:p,className:"text-gray-400 hover:text-gray-600 ml-2","aria-label":"Close",children:"\xd7"})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-700 mb-2",children:[(0,a.jsx)("strong",{children:"Definition:"})," ","simple"===s?o.definitionSimple:o.definitionClinical]}),(0,a.jsxs)("p",{className:"text-sm text-gray-700 mb-2",children:[(0,a.jsx)("strong",{children:"Why it matters:"})," ",o.whyItMatters]}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 italic",children:["Example: ",o.exampleSimple]})]}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)("button",{onClick:()=>{if(o&&l&&l(o.term),o){let e=localStorage.getItem("savedVocab"),t=e?JSON.parse(e):{};t[o.term]||(t[o.term]={savedAt:Date.now(),correct:0,attempts:0},localStorage.setItem("savedVocab",JSON.stringify(t)))}d(null),m(null)},className:"flex-1 px-3 py-2 bg-primary-600 text-white rounded hover:bg-primary-700 transition text-sm font-medium flex items-center justify-center gap-1",children:"⭐ Save to My Vocab"})}),o.tags.length>0&&(0,a.jsx)("div",{className:"mt-2 pt-2 border-t border-gray-200",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:o.tags.map(e=>(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded",children:e},e))})})]})]})]})}function o(e){let{scenario:t,messages:s,onChatUpdate:r,viewMode:n="simple",onTermClick:o,onTermSave:d}=e,[c,m]=(0,i.useState)(s||[{role:"patient",content:"Hello, doctor. ".concat(t.patientPersona.chiefComplaint,".")}]),[x,u]=(0,i.useState)(""),[p,g]=(0,i.useState)(!1),h=(0,i.useRef)(null),y=(0,i.useRef)(null);(0,i.useEffect)(()=>{let e=e=>{y.current&&(u(e.detail.question),y.current.focus())};return window.addEventListener("insert-question",e),()=>{window.removeEventListener("insert-question",e)}},[]),(0,i.useEffect)(()=>{r(c)},[c,r]),(0,i.useEffect)(()=>{s&&s.length>0&&m(s)},[s]),(0,i.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[c]);let b=async e=>{if(e.preventDefault(),!x.trim()||p)return;let s=[...c,{role:"doctor",content:x.trim()}];m(s),u(""),g(!0);try{let e=await fetch("/api/patient-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scenarioId:t.id,messages:s})});if(!e.ok){let t;try{t=await e.json()}catch(t){throw Error("Server error: ".concat(e.status," ").concat(e.statusText))}let s=(null==t?void 0:t.error)||(null==t?void 0:t.details)||"Server error: ".concat(e.status);throw console.error("API Error Response:",{status:e.status,error:null==t?void 0:t.error,details:null==t?void 0:t.details,fullResponse:t}),Error(s)}let a=await e.json();if(a.error)throw Error(a.error);if(!a.message)throw Error("No message received from API");let i={role:"patient",content:a.message};m([...s,i])}catch(t){console.error("Error in ChatPanel:",t);let e="I'm sorry, I'm having trouble responding right now. Could you try again?";if(null==t?void 0:t.message){let s=t.message.toLowerCase();e=s.includes("api key")||s.includes("openai")?"⚠️ Error: OpenAI API key is not configured or invalid. Please check your .env.local file and restart the server. Test your key at /api/test-key":s.includes("rate limit")?"⚠️ Error: API rate limit exceeded. Please try again later.":s.includes("network")||s.includes("fetch")?"⚠️ Error: Network error. Please check your connection and that the server is running.":"⚠️ Error: ".concat(t.message)}m([...s,{role:"patient",content:e}])}finally{g(!1)}};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 flex flex-col h-full",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"History & Interview"}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto mb-4 space-y-4 pr-2",children:[c.map((e,s)=>(0,a.jsx)("div",{className:"flex ".concat("doctor"===e.role?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[80%] rounded-lg px-4 py-2 ".concat("doctor"===e.role?"bg-primary-600 text-white":"bg-gray-100 text-gray-900"),children:[(0,a.jsx)("p",{className:"text-sm font-medium mb-1",children:"doctor"===e.role?"You":t.patientPersona.name}),(0,a.jsx)("div",{className:"text-sm whitespace-pre-wrap",children:"patient"===e.role?(0,a.jsx)(l,{text:e.content,viewMode:n,onTermClick:o,onTermSave:d}):e.content})]})},s)),p&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"bg-gray-100 rounded-lg px-4 py-2",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Patient is typing..."})})}),(0,a.jsx)("div",{ref:h})]}),(0,a.jsxs)("form",{onSubmit:b,className:"flex gap-2",children:[(0,a.jsx)("input",{id:"chat-input",ref:y,type:"text",value:x,onChange:e=>u(e.target.value),placeholder:"Ask the patient a question...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",disabled:p}),(0,a.jsx)("button",{type:"submit",disabled:p||!x.trim(),className:"px-6 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition",children:"Send"})]})]})}function d(e){let{sections:t,viewedSections:s=[],onSectionsViewed:r,viewMode:n="simple",onTermClick:o,onTermSave:d}=e,[c,m]=(0,i.useState)(new Set(s)),[x,u]=(0,i.useState)(null);(0,i.useEffect)(()=>{m(new Set(s))},[s]);let p=e=>{let t=new Set(c);t.add(e),m(t),u(x===e?null:e),r(Array.from(t))};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Physical Examination"}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:t.map(e=>{let t=c.has(e.id),s=x===e.id;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("button",{onClick:()=>p(e.id),className:"w-full px-4 py-3 rounded-lg border-2 transition ".concat(t?"border-primary-500 bg-primary-50 text-primary-900":"border-gray-200 bg-white text-gray-700 hover:border-primary-300"),children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:e.label}),t&&(0,a.jsx)("p",{className:"text-xs text-primary-600 mt-1",children:"✓ Viewed"})]}),s&&(0,a.jsxs)("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Summary:"}),(0,a.jsx)("p",{className:"text-sm text-gray-700 mb-2",children:(0,a.jsx)(l,{text:e.summary,viewMode:n,onTermClick:o,onTermSave:d})}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Details:"}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:(0,a.jsx)(l,{text:e.details,viewMode:n,onTermClick:o,onTermSave:d})})]})]},e.id)})})]})}let c=[{id:"ecg",name:"ECG (Electrocardiogram)",category:"Cardiac",kind:"Bedside",description:"Records the electrical activity of the heart",typicalUses:["Chest pain","Arrhythmia","ACS"],common:!0},{id:"troponin",name:"Troponin I",category:"Cardiac",kind:"Lab",description:"Cardiac injury marker, elevated in myocardial infarction",typicalUses:["ACS","Chest pain"],common:!0},{id:"bnp",name:"BNP (Brain Natriuretic Peptide)",category:"Cardiac",kind:"Lab",description:"Marker for heart failure",typicalUses:["Heart failure","Dyspnea"],common:!0},{id:"echo",name:"Echocardiogram",category:"Cardiac",kind:"Imaging",description:"Ultrasound of the heart",typicalUses:["Heart failure","Valvular disease"],common:!0},{id:"stress_test",name:"Stress Test",category:"Cardiac",kind:"Procedure",description:"Exercise or pharmacologic stress testing",typicalUses:["Chest pain","Coronary disease"],common:!1},{id:"cxr",name:"Chest X-Ray",category:"Pulmonary",kind:"Imaging",description:"Evaluates lungs, heart size, and chest structures",typicalUses:["Chest pain","Dyspnea","Cough"],common:!0},{id:"ct_chest",name:"CT Chest",category:"Pulmonary",kind:"Imaging",description:"Detailed imaging of chest structures",typicalUses:["PE","Pneumonia","Mass"],common:!0},{id:"abg",name:"Arterial Blood Gas",category:"Pulmonary",kind:"Lab",description:"Measures blood oxygen, CO2, and pH",typicalUses:["Respiratory failure","Acid-base disorders"],common:!0},{id:"pft",name:"Pulmonary Function Test",category:"Pulmonary",kind:"Procedure",description:"Measures lung function",typicalUses:["COPD","Asthma"],common:!1},{id:"ct_head",name:"CT Head",category:"Neurology",kind:"Imaging",description:"Brain imaging for acute pathology",typicalUses:["Headache","Stroke","Trauma"],common:!0},{id:"mri_brain",name:"MRI Brain",category:"Neurology",kind:"Imaging",description:"Detailed brain imaging",typicalUses:["Stroke","Tumor","MS"],common:!1},{id:"eeg",name:"EEG (Electroencephalogram)",category:"Neurology",kind:"Procedure",description:"Brain electrical activity",typicalUses:["Seizure","Altered mental status"],common:!1},{id:"lumbar_puncture",name:"Lumbar Puncture",category:"Neurology",kind:"Procedure",description:"CSF analysis",typicalUses:["Meningitis","SAH"],common:!1},{id:"ct_abdomen",name:"CT Abdomen/Pelvis",category:"GI",kind:"Imaging",description:"Abdominal imaging",typicalUses:["Abdominal pain","Appendicitis"],common:!0},{id:"lipase",name:"Lipase",category:"GI",kind:"Lab",description:"Pancreatic enzyme, elevated in pancreatitis",typicalUses:["Abdominal pain","Pancreatitis"],common:!0},{id:"lft",name:"Liver Function Tests",category:"GI",kind:"Lab",description:"ALT, AST, bilirubin, etc.",typicalUses:["Hepatitis","Jaundice"],common:!0},{id:"upper_endoscopy",name:"Upper Endoscopy",category:"GI",kind:"Procedure",description:"Visualization of upper GI tract",typicalUses:["GI bleed","Dysphagia"],common:!1},{id:"creatinine",name:"Creatinine",category:"Renal",kind:"Lab",description:"Kidney function marker",typicalUses:["AKI","CKD"],common:!0},{id:"bun",name:"BUN (Blood Urea Nitrogen)",category:"Renal",kind:"Lab",description:"Kidney function marker",typicalUses:["AKI","CKD"],common:!0},{id:"ua",name:"Urinalysis",category:"Renal",kind:"Lab",description:"Urine analysis",typicalUses:["UTI","AKI","Nephritis"],common:!0},{id:"glucose",name:"Glucose",category:"Endocrine",kind:"Lab",description:"Blood sugar level",typicalUses:["Diabetes","Hypoglycemia"],common:!0},{id:"hba1c",name:"HbA1c",category:"Endocrine",kind:"Lab",description:"Long-term glucose control",typicalUses:["Diabetes"],common:!1},{id:"tsh",name:"TSH",category:"Endocrine",kind:"Lab",description:"Thyroid function",typicalUses:["Hypothyroidism","Hyperthyroidism"],common:!1},{id:"cbc",name:"CBC (Complete Blood Count)",category:"Hematology",kind:"Lab",description:"Red cells, white cells, platelets",typicalUses:["Infection","Anemia","Bleeding"],common:!0},{id:"blood_culture",name:"Blood Culture",category:"Infectious",kind:"Lab",description:"Bacterial infection detection",typicalUses:["Sepsis","Fever"],common:!0},{id:"urine_culture",name:"Urine Culture",category:"Infectious",kind:"Lab",description:"Bacterial UTI detection",typicalUses:["UTI"],common:!0},{id:"covid",name:"COVID-19 PCR",category:"Infectious",kind:"Lab",description:"SARS-CoV-2 detection",typicalUses:["Respiratory infection"],common:!0},{id:"pt_inr",name:"PT/INR",category:"Hematology",kind:"Lab",description:"Coagulation studies",typicalUses:["Bleeding","Anticoagulation"],common:!0},{id:"d_dimer",name:"D-Dimer",category:"Hematology",kind:"Lab",description:"Clotting marker, elevated in DVT/PE",typicalUses:["PE","DVT"],common:!0},{id:"ferritin",name:"Ferritin",category:"Hematology",kind:"Lab",description:"Iron storage",typicalUses:["Anemia"],common:!1},{id:"xray_extremity",name:"X-Ray Extremity",category:"MSK",kind:"Imaging",description:"Bone imaging",typicalUses:["Fracture","Trauma"],common:!0},{id:"mri_spine",name:"MRI Spine",category:"MSK",kind:"Imaging",description:"Spinal cord and vertebrae imaging",typicalUses:["Back pain","Cord compression"],common:!1},{id:"cmp",name:"CMP (Comprehensive Metabolic Panel)",category:"Other",kind:"Lab",description:"Electrolytes, kidney function, liver function",typicalUses:["General screening","Metabolic disorders"],common:!0},{id:"lipid",name:"Lipid Panel",category:"Other",kind:"Lab",description:"Cholesterol and triglycerides",typicalUses:["Cardiovascular risk"],common:!1},{id:"us_abdomen",name:"Ultrasound Abdomen",category:"Imaging",kind:"Imaging",description:"Abdominal ultrasound",typicalUses:["Gallstones","Aortic aneurysm"],common:!0}];function m(e){let{scenario:t,orderedTests:s,onTestsOrdered:r,viewMode:n="simple",onTermClick:o,onTermSave:d}=e,[m,x]=(0,i.useState)("All"),[u,p]=(0,i.useState)("All"),[g,h]=(0,i.useState)(""),[y,b]=(0,i.useState)(!1),[f,v]=(0,i.useState)(s||new Map);(0,i.useEffect)(()=>{s&&v(s)},[s]);let j=(0,i.useMemo)(()=>c.filter(e=>{let t="All"===m||e.category===m,s="All"===u||e.kind===u,a=""===g||e.name.toLowerCase().includes(g.toLowerCase())||e.description.toLowerCase().includes(g.toLowerCase()),i=!y||e.common;return t&&s&&a&&i}),[m,u,g,y]),N=e=>{if(f.has(e))return;let s=function(e,t){var s;let a;let i=c.find(e=>e.id===t);if(!i)throw Error("Test ".concat(t," not found in catalog"));let r=null===(s=e.testOverrides)||void 0===s?void 0:s.find(e=>e.testId===t);if(r)return{test:i,result:r.result,yield:r.yield};let n=e.testDefaultBehavior||{labDefault:"Within normal limits.",imagingDefault:"No acute abnormality.",bedsideDefault:"No significant abnormality.",procedureDefault:"Not indicated in this case."},l="low";switch(i.kind){case"Lab":a=n.labDefault;break;case"Imaging":a=n.imagingDefault;break;case"Bedside":a=n.bedsideDefault;break;case"Procedure":a=n.procedureDefault,l="inappropriate";break;default:a="Result not available."}return{test:i,result:a,yield:l}}(t,e),a=new Map(f);a.set(e,{testId:e,result:s.result}),v(a),r(a)};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Diagnostic Tests"}),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"lg:w-48 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,a.jsxs)("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:[(0,a.jsx)("button",{onClick:()=>x("All"),className:"w-full text-left px-3 py-2 rounded text-sm ".concat("All"===m?"bg-primary-100 text-primary-800 font-medium":"text-gray-700 hover:bg-gray-50"),children:"All Categories"}),["Cardiac","Pulmonary","Neurology","GI","Renal","Endocrine","Infectious","Hematology","MSK","Imaging","Other"].map(e=>(0,a.jsx)("button",{onClick:()=>x(e),className:"w-full text-left px-3 py-2 rounded text-sm ".concat(m===e?"bg-primary-100 text-primary-800 font-medium":"text-gray-700 hover:bg-gray-50"),children:e},e))]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kind"}),(0,a.jsx)("div",{className:"space-y-1",children:["All","Lab","Imaging","Bedside","Procedure"].map(e=>(0,a.jsx)("button",{onClick:()=>p(e),className:"w-full text-left px-3 py-2 rounded text-sm ".concat(u===e?"bg-primary-100 text-primary-800 font-medium":"text-gray-700 hover:bg-gray-50"),children:e},e))})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:y,onChange:e=>b(e.target.checked),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Common only"})]})})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("input",{type:"text",placeholder:"Search tests...",value:g,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})}),(0,a.jsx)("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:j.map(e=>{var t;let s=f.has(e.id);return(0,a.jsxs)("div",{className:"border-2 rounded-lg p-4 ".concat(s?"border-primary-500 bg-primary-50":"border-gray-200 bg-white"),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-700 text-xs rounded",children:e.kind}),e.common&&(0,a.jsx)("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded",children:"Common"}),s&&(0,a.jsx)("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded",children:"Ordered"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:(0,a.jsx)(l,{text:e.description,viewMode:n,onTermClick:o,onTermSave:d})}),e.typicalUses.length>0&&(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Typical uses: ",e.typicalUses.join(", ")]})]}),!s&&(0,a.jsx)("button",{onClick:()=>N(e.id),className:"ml-4 px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition text-sm whitespace-nowrap",children:"Order"})]}),s&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"Result:"}),(0,a.jsx)("p",{className:"text-sm text-gray-700 bg-white p-2 rounded border border-gray-200",children:(0,a.jsx)(l,{text:(null===(t=f.get(e.id))||void 0===t?void 0:t.result)||"",viewMode:n,onTermClick:o,onTermSave:d})})]})]},e.id)})}),0===j.length&&(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No tests match your filters."})]})]})]})}let x=[{id:"stemi",name:"ST-elevation myocardial infarction (STEMI)",category:"Cardiac",brief:"Acute coronary occlusion causing myocardial injury.",typicalClues:["Exertional chest pressure","Radiation to arm/jaw","ECG ST elevation","Elevated troponin"],common:!0},{id:"nstemi",name:"Non-ST elevation myocardial infarction (NSTEMI)",category:"Cardiac",brief:"Myocardial infarction without ST elevation on ECG.",typicalClues:["Chest pain","Elevated troponin","No ST elevation"],common:!0},{id:"unstable_angina",name:"Unstable angina",category:"Cardiac",brief:"Chest pain from coronary artery disease, not meeting MI criteria.",typicalClues:["Chest pain","Normal troponin","ECG changes"],common:!0},{id:"aortic_dissection",name:"Aortic dissection",category:"Cardiac",brief:"Tear in the aortic wall, life-threatening emergency.",typicalClues:["Tearing chest pain","Hypertension","Pulse deficit","Widened mediastinum"],common:!1},{id:"pericarditis",name:"Pericarditis",category:"Cardiac",brief:"Inflammation of the pericardium.",typicalClues:["Sharp chest pain","Worse lying flat","Pericardial rub","Diffuse ST elevation"],common:!1},{id:"pe",name:"Pulmonary embolism (PE)",category:"Pulmonary",brief:"Blood clot blocking pulmonary artery.",typicalClues:["Dyspnea","Chest pain","Tachycardia","Elevated D-dimer"],common:!0},{id:"pneumonia",name:"Pneumonia",category:"Pulmonary",brief:"Lung infection causing inflammation.",typicalClues:["Fever","Cough","Chest X-ray infiltrate","Elevated WBC"],common:!0},{id:"pneumothorax",name:"Pneumothorax",category:"Pulmonary",brief:"Collapsed lung from air in pleural space.",typicalClues:["Sudden dyspnea","Chest pain","Decreased breath sounds","Hyperresonance"],common:!1},{id:"copd_exacerbation",name:"COPD exacerbation",category:"Pulmonary",brief:"Acute worsening of chronic obstructive pulmonary disease.",typicalClues:["Dyspnea","Wheezing","COPD history","Increased sputum"],common:!0},{id:"stroke",name:"Ischemic stroke",category:"Neurology",brief:"Brain tissue death from blocked blood supply.",typicalClues:["Focal neurologic deficit","Sudden onset","CT head negative early","Risk factors"],common:!0},{id:"tia",name:"Transient ischemic attack (TIA)",category:"Neurology",brief:"Temporary stroke symptoms that resolve.",typicalClues:["Focal deficit","Resolves <24h","No CT changes"],common:!0},{id:"migraine",name:"Migraine",category:"Neurology",brief:"Severe headache with associated symptoms.",typicalClues:["Unilateral headache","Photophobia","Nausea","Aura"],common:!0},{id:"meningitis",name:"Meningitis",category:"Neurology",brief:"Infection of the meninges.",typicalClues:["Headache","Fever","Neck stiffness","Altered mental status"],common:!1},{id:"subarachnoid_hemorrhage",name:"Subarachnoid hemorrhage (SAH)",category:"Neurology",brief:"Bleeding into subarachnoid space.",typicalClues:["Thunderclap headache","Neck stiffness","CT head positive","Bloody CSF"],common:!1},{id:"gerd",name:"Gastroesophageal reflux disease (GERD)",category:"GI",brief:"Acid reflux causing burning chest discomfort.",typicalClues:["Burning pain","Post-meal","Worse lying down","Relief with antacids"],common:!0},{id:"pancreatitis",name:"Acute pancreatitis",category:"GI",brief:"Inflammation of the pancreas.",typicalClues:["Epigastric pain","Radiation to back","Elevated lipase","Nausea/vomiting"],common:!0},{id:"appendicitis",name:"Appendicitis",category:"GI",brief:"Inflammation of the appendix.",typicalClues:["RLQ pain","Fever","Elevated WBC","CT findings"],common:!0},{id:"cholecystitis",name:"Acute cholecystitis",category:"GI",brief:"Inflammation of the gallbladder.",typicalClues:["RUQ pain","Fever","Elevated WBC","Positive Murphy's sign"],common:!0},{id:"sepsis",name:"Sepsis",category:"Infectious",brief:"Life-threatening organ dysfunction from infection.",typicalClues:["Fever","Hypotension","Tachycardia","Elevated lactate"],common:!0},{id:"uti",name:"Urinary tract infection (UTI)",category:"Infectious",brief:"Bacterial infection of urinary system.",typicalClues:["Dysuria","Frequency","Positive urine culture","Pyuria"],common:!0},{id:"dka",name:"Diabetic ketoacidosis (DKA)",category:"Endocrine",brief:"Severe hyperglycemia with metabolic acidosis.",typicalClues:["Hyperglycemia","Ketones","Acidosis","Altered mental status"],common:!1},{id:"hypoglycemia",name:"Hypoglycemia",category:"Endocrine",brief:"Low blood sugar.",typicalClues:["Altered mental status","Sweating","Tremor","Low glucose"],common:!0},{id:"aki",name:"Acute kidney injury (AKI)",category:"Renal",brief:"Sudden decline in kidney function.",typicalClues:["Elevated creatinine","Oliguria","Volume depletion","Nephrotoxins"],common:!0},{id:"panic",name:"Panic attack",category:"Psych",brief:"Acute anxiety episode with physical symptoms.",typicalClues:["Palpitations","Fear","Tingling","Hyperventilation","No organic findings"],common:!0},{id:"anxiety",name:"Anxiety disorder",category:"Psych",brief:"Persistent excessive worry and anxiety.",typicalClues:["Worry","Restlessness","Fatigue","Difficulty concentrating"],common:!0},{id:"muscle_strain",name:"Muscle strain",category:"MSK",brief:"Injury to muscle or tendon.",typicalClues:["Pain with movement","Localized tenderness","No systemic symptoms"],common:!0},{id:"costochondritis",name:"Costochondritis",category:"Other",brief:"Inflammation of costochondral joints.",typicalClues:["Chest wall tenderness","Reproducible pain","No cardiac findings"],common:!0}];function u(e,t){var s;let a=x.find(e=>e.id===t);if(!a)throw Error("Diagnosis ".concat(t," not found in catalog"));let i=null===(s=e.dxOverrides)||void 0===s?void 0:s.find(e=>e.dxId===t);return i?{dx:a,yield:i.yield,explanation:i.explanation}:{dx:a,yield:"irrelevant",explanation:"Not strongly supported by this case data."}}function p(e,t){return t?t.filter(t=>!e.includes(t)):[]}function g(e){let{scenario:t,differential:s=[],finalDxId:r=null,onDifferentialUpdate:n,onFinalDxUpdate:o,onSubmit:d,viewMode:c="simple",onTermClick:m,onTermSave:g}=e,[h,y]=(0,i.useState)("All"),[b,f]=(0,i.useState)(""),[v,j]=(0,i.useState)(!1),[N,w]=(0,i.useState)(s),[C,k]=(0,i.useState)(r);(0,i.useEffect)(()=>{w(s)},[s]),(0,i.useEffect)(()=>{k(r)},[r]);let S=(0,i.useMemo)(()=>x.filter(e=>{let t="All"===h||e.category===h,s=""===b||e.name.toLowerCase().includes(b.toLowerCase())||e.brief.toLowerCase().includes(b.toLowerCase())||e.typicalClues.some(e=>e.toLowerCase().includes(b.toLowerCase())),a=!v||e.common,i=!N.find(t=>t.dxId===e.id);return t&&s&&a&&i}),[h,b,v,N]),I=e=>{let t=N.length+1,s=[...N,{dxId:e,rank:t,confidence:"Medium",note:""}];w(s),null==n||n(s)},T=e=>{let t=N.filter(t=>t.dxId!==e).map((e,t)=>({...e,rank:t+1}));w(t),null==n||n(t),C===e&&(k(null),null==o||o(null))},P=(e,t)=>{let s=N.findIndex(t=>t.dxId===e);if(-1===s)return;let a="up"===t?s-1:s+1;if(a<0||a>=N.length)return;let i=[...N];[i[s],i[a]]=[i[a],i[s]];let r=i.map((e,t)=>({...e,rank:t+1}));w(r),null==n||n(r)},D=(e,t)=>{let s=N.map(s=>s.dxId===e?{...s,confidence:t}:s);w(s),null==n||n(s)},E=(e,t)=>{let s=N.map(s=>s.dxId===e?{...s,note:t}:s);w(s),null==n||n(s)},A=[...N].sort((e,t)=>e.rank-t.rank),M=p(N.map(e=>e.dxId),t.requiredMustNotMiss);return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Diagnosis"}),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"lg:w-48 flex-shrink-0",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,a.jsxs)("div",{className:"space-y-1 max-h-64 overflow-y-auto",children:[(0,a.jsx)("button",{onClick:()=>y("All"),className:"w-full text-left px-3 py-2 rounded text-sm ".concat("All"===h?"bg-primary-100 text-primary-800 font-medium":"text-gray-700 hover:bg-gray-50"),children:"All Categories"}),["Cardiac","Pulmonary","Neurology","GI","Infectious","Endocrine","Renal","Hematology","Psych","MSK","Other"].map(e=>(0,a.jsx)("button",{onClick:()=>y(e),className:"w-full text-left px-3 py-2 rounded text-sm ".concat(h===e?"bg-primary-100 text-primary-800 font-medium":"text-gray-700 hover:bg-gray-50"),children:e},e))]})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:v,onChange:e=>j(e.target.checked),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Common only"})]})})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("input",{type:"text",placeholder:"Search diagnoses...",value:b,onChange:e=>f(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500"})}),(0,a.jsx)("div",{className:"space-y-2 max-h-[400px] overflow-y-auto mb-6",children:S.map(e=>(u(t,e.id),(0,a.jsx)("div",{className:"border border-gray-200 rounded-lg p-3 hover:bg-gray-50",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900",children:e.name}),e.common&&(0,a.jsx)("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded",children:"Common"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:(0,a.jsx)(l,{text:e.brief,viewMode:c,onTermClick:m,onTermSave:g})}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["Clues: ",e.typicalClues.join(", ")]})]}),(0,a.jsx)("button",{onClick:()=>I(e.id),className:"ml-4 px-3 py-1 bg-primary-600 text-white rounded text-sm hover:bg-primary-700 whitespace-nowrap",children:"Add to DDx"})]})},e.id)))}),0===S.length&&(0,a.jsx)("div",{className:"text-center py-8 text-gray-500 mb-6",children:"No diagnoses match your filters."})]})]}),N.length>0&&(0,a.jsxs)("div",{className:"mt-6 border-t border-gray-200 pt-6",children:[(0,a.jsx)("h3",{className:"text-md font-semibold text-gray-900 mb-4",children:"Your Differential Diagnosis (Ranked)"}),M.length>0&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-yellow-800 font-medium mb-1",children:"\uD83D\uDCA1 Consider These Must-Not-Miss Diagnoses:"}),(0,a.jsx)("p",{className:"text-xs text-yellow-700 mb-2",children:"These are dangerous diagnoses that should be considered in your differential, even if you rule them out. Good clinical practice requires evaluating them for chest pain cases."}),(0,a.jsx)("ul",{className:"text-sm text-yellow-700 list-disc list-inside",children:M.map(e=>{let t=x.find(t=>t.id===e);return(0,a.jsx)("li",{children:(null==t?void 0:t.name)||e},e)})})]}),(0,a.jsx)("div",{className:"space-y-3",children:A.map(e=>{let s=x.find(t=>t.id===e.dxId),i=u(t,e.dxId);return(0,a.jsxs)("div",{className:"border-2 rounded-lg p-4 ".concat("correct"===i.yield?"border-green-300 bg-green-50":"reasonable"===i.yield?"border-blue-300 bg-blue-50":"dangerous-miss"===i.yield?"border-red-300 bg-red-50":"border-gray-200 bg-gray-50"),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsxs)("span",{className:"font-bold text-gray-700",children:["#",e.rank]}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:null==s?void 0:s.name})]}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:(0,a.jsx)(l,{text:i.explanation,viewMode:c,onTermClick:m,onTermSave:g})})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>P(e.dxId,"up"),disabled:1===e.rank,className:"px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs hover:bg-gray-200 disabled:opacity-50",children:"↑"}),(0,a.jsx)("button",{onClick:()=>P(e.dxId,"down"),disabled:e.rank===N.length,className:"px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs hover:bg-gray-200 disabled:opacity-50",children:"↓"}),(0,a.jsx)("button",{onClick:()=>T(e.dxId),className:"px-2 py-1 bg-red-100 text-red-700 rounded text-xs hover:bg-red-200",children:"Remove"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Confidence"}),(0,a.jsxs)("select",{value:e.confidence,onChange:t=>D(e.dxId,t.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",children:[(0,a.jsx)("option",{value:"High",children:"High"}),(0,a.jsx)("option",{value:"Medium",children:"Medium"}),(0,a.jsx)("option",{value:"Low",children:"Low"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Reasoning Note (optional)"}),(0,a.jsx)("input",{type:"text",value:e.note||"",onChange:t=>E(e.dxId,t.target.value),placeholder:"Brief reasoning...",className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"})]})]})]},e.dxId)})})]}),(0,a.jsxs)("div",{className:"mt-6 border-t border-gray-200 pt-6",children:[(0,a.jsx)("h3",{className:"text-md font-semibold text-gray-900 mb-4",children:"Final Diagnosis (select one from your differential)"}),0===N.length?(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Add diagnoses to your differential first."}):(0,a.jsx)("div",{className:"space-y-2",children:A.map(e=>{let t=x.find(t=>t.id===e.dxId);return(0,a.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"final-diagnosis",checked:C===e.dxId,onChange:()=>{k(e.dxId),null==o||o(e.dxId)},className:"mt-1 mr-3"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-900 font-medium",children:["#",e.rank," - ",null==t?void 0:t.name]}),e.confidence&&(0,a.jsxs)("span",{className:"ml-2 px-2 py-0.5 bg-gray-100 text-gray-700 text-xs rounded",children:[e.confidence," confidence"]}),e.note&&(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["Note: ",e.note]})]})]},e.dxId)})})]}),(0,a.jsx)("button",{onClick:()=>{if(C){let e=p(N.map(e=>e.dxId),t.requiredMustNotMiss);d({differentialDetailed:N,finalDxId:C,missingMustNotMiss:e})}},disabled:!C||0===N.length,className:"w-full mt-6 px-6 py-3 bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed transition font-medium",children:"Get Assessment"})]})}let h={Excellent:"bg-green-100 text-green-800 border-green-300",Good:"bg-blue-100 text-blue-800 border-blue-300","Needs Improvement":"bg-yellow-100 text-yellow-800 border-yellow-300",Poor:"bg-red-100 text-red-800 border-red-300"};function y(e){let{scenario:t,assessment:s,viewMode:i="simple",clickedTerms:r=[],savedTerms:o=[],onTermClick:d,onTermSave:c}=e,m=[];s.strengths.some(e=>e.toLowerCase().includes("history")||e.toLowerCase().includes("interview"))&&m.push("History Builder"),s.strengths.some(e=>e.toLowerCase().includes("red flag")||e.toLowerCase().includes("urgent"))&&m.push("Red Flag Spotter"),s.strengths.some(e=>e.toLowerCase().includes("test")||e.toLowerCase().includes("diagnostic"))&&m.push("Smart Test Picker"),s.strengths.some(e=>e.toLowerCase().includes("differential")||e.toLowerCase().includes("diagnosis"))&&m.push("Differential Thinker"),s.strengths.some(e=>e.toLowerCase().includes("communication")||e.toLowerCase().includes("rapport"))&&m.push("Clear Communicator");let x=r.length,u=n.AS.filter(e=>{let t=s.missedKeyHistoryPoints.some(t=>t.toLowerCase().includes(e.term.toLowerCase())||e.tags.some(e=>t.toLowerCase().includes(e))),a=e.tags.includes("red-flag")||e.tags.includes("cardiac");return(t||a)&&!o.includes(e.term)}).slice(0,5).map(e=>e.term);return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Assessment & Debrief"}),(0,a.jsxs)("div",{className:"mb-6 p-4 bg-gradient-to-r from-primary-50 to-blue-50 rounded-lg border-2 border-primary-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"\uD83C\uDFC6 Badges Earned"}),m.length>0?(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:m.map((e,t)=>(0,a.jsx)("span",{className:"px-4 py-2 bg-primary-600 text-white rounded-full text-sm font-medium shadow-sm",children:e},t))}):(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Keep practicing to earn badges!"})]}),(0,a.jsxs)("div",{className:"mb-6 p-4 bg-purple-50 rounded-lg border border-purple-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"\uD83D\uDCDA Vocabulary Learning"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("strong",{children:"New terms encountered:"})," ",x," ",1===x?"term":"terms"]}),o.length>0&&(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,a.jsx)("strong",{children:"Terms saved:"})," ",o.length," ",1===o.length?"term":"terms"]}),u.length>0&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 mb-2",children:"Recommended terms to review:"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:u.map(e=>{let t=(0,n.lq)(e);return t?(0,a.jsx)("button",{onClick:()=>null==d?void 0:d(e),className:"px-3 py-1 bg-white border border-purple-300 text-purple-700 rounded-md hover:bg-purple-100 text-sm transition",children:t.display},e):null})})]})]})]}),(0,a.jsx)("div",{className:"mb-6 p-4 rounded-lg border-2 ".concat(h[s.overallRating]||h.Good),children:(0,a.jsxs)("p",{className:"text-lg font-semibold",children:["Overall Performance: ",s.overallRating]})}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Summary"}),(0,a.jsx)("p",{className:"text-gray-700",children:(0,a.jsx)(l,{text:s.summary,viewMode:i,onTermClick:d,onTermSave:c})})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-green-700 mb-2",children:"✓ Strengths"}),(0,a.jsx)("ul",{className:"list-disc list-inside space-y-1 text-gray-700",children:s.strengths.map((e,t)=>(0,a.jsx)("li",{children:(0,a.jsx)(l,{text:e,viewMode:i,onTermClick:d,onTermSave:c})},t))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-yellow-700 mb-2",children:"Areas for Improvement"}),(0,a.jsx)("ul",{className:"list-disc list-inside space-y-1 text-gray-700",children:s.areasForImprovement.map((e,t)=>(0,a.jsx)("li",{children:(0,a.jsx)(l,{text:e,viewMode:i,onTermClick:d,onTermSave:c})},t))})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Diagnosis Feedback"}),(0,a.jsx)("p",{className:"text-gray-700",children:(0,a.jsx)(l,{text:s.diagnosisFeedback,viewMode:i,onTermClick:d,onTermSave:c})})]}),s.missedKeyHistoryPoints.length>0&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Missed Key History Points"}),(0,a.jsx)("ul",{className:"list-disc list-inside space-y-1 text-gray-700",children:s.missedKeyHistoryPoints.map((e,t)=>(0,a.jsx)("li",{children:(0,a.jsx)(l,{text:e,viewMode:i,onTermClick:d,onTermSave:c})},t))})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Test Selection Feedback"}),(0,a.jsx)("p",{className:"text-gray-700",children:(0,a.jsx)(l,{text:s.testSelectionFeedback,viewMode:i,onTermClick:d,onTermSave:c})})]}),(0,a.jsxs)("div",{className:"border-t border-gray-200 pt-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Teaching Points"}),(0,a.jsx)("ul",{className:"list-disc list-inside space-y-2 text-gray-700",children:t.teachingPoints.map((e,t)=>(0,a.jsx)("li",{children:(0,a.jsx)(l,{text:e,viewMode:i,onTermClick:d,onTermSave:c})},t))})]})]})}function b(e){let{active:t,onChange:s,sections:i}=e;return(0,a.jsx)("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 mb-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)("div",{className:"hidden md:flex",children:i.map(e=>{let i=t===e.id,r=e.disabled;return(0,a.jsxs)("button",{onClick:()=>!r&&s(e.id),disabled:r,className:"\n                  relative px-6 py-4 text-sm font-medium transition-colors\n                  border-b-2\n                  ".concat(i?"border-primary-600 text-primary-600":r?"border-transparent text-gray-400 cursor-not-allowed":"border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300","\n                "),title:r?e.disabledReason:void 0,children:[e.label,i&&(0,a.jsx)("span",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary-600"})]},e.id)})}),(0,a.jsx)("div",{className:"md:hidden",children:(0,a.jsx)("div",{className:"flex overflow-x-auto scrollbar-hide -mx-4 px-4",children:i.map(e=>{let i=t===e.id,r=e.disabled;return(0,a.jsx)("button",{onClick:()=>!r&&s(e.id),disabled:r,className:"\n                    flex-shrink-0 px-4 py-3 text-sm font-medium transition-colors\n                    border-b-2\n                    ".concat(i?"border-primary-600 text-primary-600":r?"border-transparent text-gray-400 cursor-not-allowed":"border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300","\n                  "),title:r?e.disabledReason:void 0,children:e.label},e.id)})})})]})})}let f=[{id:"main-symptom",label:"Clarify the main symptom",questions:["Can you tell me more about what you're feeling?","What does it feel like?"]},{id:"timing",label:"Understand timing and progression",questions:["When did this start?","Has it been getting better or worse?"]},{id:"location",label:"Pinpoint where it is",questions:["Where exactly do you feel it?","Does it go anywhere else?"]},{id:"red-flags",label:"Ask about 1–2 red flags",questions:["Any shortness of breath, nausea, or sweating?","Does anything make it worse?"]},{id:"background",label:"Check relevant background",questions:["Do you have any medical conditions?","Do you take any medications?"]}];function v(e){let{onInsertQuestion:t}=e,[s,r]=(0,i.useState)(new Set),n=e=>{let t=new Set(s);t.has(e)?t.delete(e):t.add(e),r(t)};return(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"History Focus"}),(0,a.jsx)("div",{className:"space-y-2",children:f.map(e=>{let i=s.has(e.id);return(0,a.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm hover:shadow transition-shadow",children:[(0,a.jsxs)("button",{onClick:()=>n(e.id),className:"w-full px-3 py-2.5 text-left flex items-center justify-between hover:bg-gray-50 transition",children:[(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.label}),(0,a.jsx)("span",{className:"text-gray-400 text-xs",children:i?"−":"+"})]}),i&&(0,a.jsx)("div",{className:"px-3 pb-3 pt-1 border-t border-gray-100 bg-gray-50",children:(0,a.jsx)("div",{className:"space-y-1.5",children:e.questions.map((e,s)=>(0,a.jsx)("button",{onClick:s=>{s.stopPropagation(),t(e)},className:"w-full text-left px-2.5 py-1.5 text-xs text-gray-700 bg-white border border-gray-200 rounded hover:bg-primary-50 hover:border-primary-300 hover:text-primary-700 transition",children:e},s))})})]},e.id)})})]})}let j=["Can you tell me more about what you're feeling?","When did this start?","What makes it better or worse?","Where exactly do you feel it?","Does it go anywhere else?","Any shortness of breath, nausea, or sweating?","Do you have any medical conditions?","Do you take any medications?"];function N(e){let{onInsertQuestion:t}=e;return(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Question Templates"}),(0,a.jsx)("p",{className:"text-xs text-gray-600 mb-3",children:"Click to insert into chat"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-1.5",children:j.map((e,s)=>(0,a.jsx)("button",{onClick:()=>t(e),className:"w-full text-left px-2.5 py-1.5 text-xs text-gray-700 bg-white border border-gray-200 rounded hover:bg-primary-50 hover:border-primary-300 hover:text-primary-700 transition",children:e},s))})]})}function w(e){let{scenario:t,messages:s}=e,i=s.map(e=>e.content.toLowerCase()).join(" "),r=[{category:"Timing",status:i.includes("when")||i.includes("start")||i.includes("time")?"explored":i.includes("duration")||i.includes("how long")?"partial":"not-discussed"},{category:"Red flags",status:i.includes("short of breath")||i.includes("sweating")||i.includes("nausea")||i.includes("dizzy")?"explored":i.includes("feel")||i.includes("symptom")?"partial":"not-discussed"},{category:"Background",status:i.includes("medication")||i.includes("condition")||i.includes("medical history")?"explored":i.includes("health")||i.includes("doctor")?"partial":"not-discussed"}],n=e=>{switch(e){case"explored":return"text-green-600";case"partial":return"text-yellow-600";default:return"text-gray-400"}},l=e=>{switch(e){case"explored":return"explored";case"partial":return"partially explored";default:return"not yet discussed"}};return(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-3 mb-6",children:[(0,a.jsx)("h3",{className:"text-xs font-medium text-blue-900 mb-2",children:"Progress Hints"}),(0,a.jsx)("div",{className:"space-y-1.5",children:r.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,a.jsxs)("span",{className:"text-gray-700",children:[e.category,":"]}),(0,a.jsx)("span",{className:n(e.status),children:l(e.status)})]},t))})]})}function C(e){let{scenario:t,learningMode:s,viewMode:i,onInsertQuestion:r,messages:n=[]}=e;return"advanced"===s?(0,a.jsx)("div",{className:"h-full flex flex-col overflow-y-auto pr-2",children:(0,a.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Take a focused history."})})}):(0,a.jsxs)("div",{className:"h-full flex flex-col overflow-y-auto pr-2",children:["guided"===s&&(0,a.jsx)(v,{onInsertQuestion:r}),"guided"===s&&n.length>0&&(0,a.jsx)(w,{scenario:t,messages:n}),"guided"===s&&(0,a.jsx)(N,{onInsertQuestion:r})]})}function k(e){let{scenario:t}=e,[s,n]=(0,i.useState)("history"),[l,c]=(0,i.useState)("guided"),[x,u]=(0,i.useState)("simple"),[p,h]=(0,i.useState)([{role:"patient",content:"Hello, doctor. ".concat(t.patientPersona.chiefComplaint,".")}]),[f,v]=(0,i.useState)([]),[j,N]=(0,i.useState)(new Map),[w,k]=(0,i.useState)([]),[S,I]=(0,i.useState)(null),[T,P]=(0,i.useState)(null),[D,E]=(0,i.useState)(!1),[A,M]=(0,i.useState)([]),[L,U]=(0,i.useState)([]),[R,H]=(0,i.useState)(!1),[B,F]=(0,i.useState)("chat");(0,i.useEffect)(()=>{let e=()=>{H(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let G=e=>{h(e)},O=e=>{A.includes(e)||M([...A,e])},_=e=>{L.includes(e)||U([...L,e])},K=e=>{let t=new CustomEvent("insert-question",{detail:{question:e}});window.dispatchEvent(t)},V=async e=>{E(!0),n("debrief");try{let s=await fetch("/api/assess",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scenarioId:t.id,chat:p,viewedExamSections:f,orderedTests:Array.from(j.keys()),differentialDetailed:w,finalDxId:S,missingMustNotMiss:e.missingMustNotMiss,selectedDifferentialIds:w.map(e=>e.dxId),finalDiagnosisId:S})});if(!s.ok)throw Error("Failed to get assessment");let a=await s.json();P(a)}catch(e){console.error("Error:",e),P({overallRating:"Error",summary:"There was an error generating your assessment. Please try again.",strengths:[],areasForImprovement:["Unable to generate assessment"],diagnosisFeedback:"",missedKeyHistoryPoints:[],testSelectionFeedback:""})}finally{E(!1)}},W=[{id:"history",label:"History",disabled:!1},{id:"exam",label:"Exam",disabled:!1},{id:"tests",label:"Tests",disabled:!1},{id:"diagnosis",label:"Diagnosis",disabled:!(f.length>0&&j.size>0),disabledReason:"Complete the Exam and order at least one Test before moving to Diagnosis."},{id:"debrief",label:"Debrief",disabled:!(null!==S),disabledReason:"Select a final diagnosis before viewing the debrief."}];return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:t.title}),(0,a.jsx)("p",{className:"text-gray-600",children:t.description})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-3 items-end",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{htmlFor:"learning-mode",className:"text-sm font-medium text-gray-700",children:"Learning Mode:"}),(0,a.jsxs)("select",{id:"learning-mode",value:l,onChange:e=>c(e.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",children:[(0,a.jsx)("option",{value:"guided",children:"Guided"}),(0,a.jsx)("option",{value:"standard",children:"Standard"}),(0,a.jsx)("option",{value:"advanced",children:"Advanced"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"View:"}),(0,a.jsxs)("div",{className:"flex bg-gray-100 rounded-md p-1",children:[(0,a.jsx)("button",{onClick:()=>u("simple"),className:"px-3 py-1 text-sm font-medium rounded transition ".concat("simple"===x?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Simple"}),(0,a.jsx)("button",{onClick:()=>u("clinical"),className:"px-3 py-1 text-sm font-medium rounded transition ".concat("clinical"===x?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Clinical"})]})]})]})]})}),(0,a.jsxs)("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"font-semibold text-blue-900 mb-2",children:"Vital Signs"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-blue-700 font-medium",children:"HR:"})," ",t.patientPersona.vitals.heartRate," bpm"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-blue-700 font-medium",children:"BP:"})," ",t.patientPersona.vitals.bloodPressure]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-blue-700 font-medium",children:"RR:"})," ",t.patientPersona.vitals.respiratoryRate," /min"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-blue-700 font-medium",children:"O2 Sat:"})," ",t.patientPersona.vitals.oxygenSat]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-blue-700 font-medium",children:"Temp:"})," ",t.patientPersona.vitals.temperature]})]})]}),(0,a.jsx)(b,{active:s,onChange:e=>{let t=W.find(t=>t.id===e);null!=t&&t.disabled||n(e)},sections:W}),"history"===s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r,{patientName:t.patientPersona.name,onPatientClick:()=>{let e=document.getElementById("chat-panel");null==e||e.scrollIntoView({behavior:"smooth",block:"start"})}}),R?(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex border-b border-gray-200 mb-4",children:[(0,a.jsx)("button",{onClick:()=>F("helper"),className:"flex-1 px-4 py-2 text-sm font-medium transition ".concat("helper"===B?"border-b-2 border-primary-600 text-primary-600":"text-gray-600 hover:text-gray-900"),children:"Helper"}),(0,a.jsx)("button",{onClick:()=>F("chat"),className:"flex-1 px-4 py-2 text-sm font-medium transition ".concat("chat"===B?"border-b-2 border-primary-600 text-primary-600":"text-gray-600 hover:text-gray-900"),children:"Chat"})]}),"helper"===B?(0,a.jsx)("div",{className:"min-h-[400px]",children:(0,a.jsx)(C,{scenario:t,learningMode:l,viewMode:x,onInsertQuestion:K,messages:p})}):(0,a.jsx)("div",{id:"chat-panel",children:(0,a.jsx)(o,{scenario:t,messages:p,onChatUpdate:G,viewMode:x,onTermClick:O,onTermSave:_})})]}):(0,a.jsx)("div",{className:"mb-6",style:{height:"600px"},children:(0,a.jsxs)("div",{className:"h-full flex gap-4",children:[(0,a.jsx)("div",{className:"w-2/5 bg-gray-50 rounded-lg overflow-hidden p-4",children:(0,a.jsx)(C,{scenario:t,learningMode:l,viewMode:x,onInsertQuestion:K,messages:p})}),(0,a.jsx)("div",{className:"flex-1 bg-white rounded-lg overflow-hidden p-4 flex flex-col",children:(0,a.jsx)("div",{id:"chat-panel",className:"flex-1 min-h-0",children:(0,a.jsx)(o,{scenario:t,messages:p,onChatUpdate:G,viewMode:x,onTermClick:O,onTermSave:_})})})]})})]}),"exam"===s&&(0,a.jsx)(d,{sections:t.physicalExam,viewedSections:f,onSectionsViewed:e=>{v(e)},viewMode:x,onTermClick:O,onTermSave:_}),"tests"===s&&(0,a.jsx)(m,{scenario:t,orderedTests:j,onTestsOrdered:e=>{N(e)},viewMode:x,onTermClick:O,onTermSave:_}),"diagnosis"===s&&(0,a.jsx)(g,{scenario:t,differential:w,finalDxId:S,onDifferentialUpdate:e=>{k(e)},onFinalDxUpdate:e=>{I(e)},onSubmit:V,viewMode:x,onTermClick:O,onTermSave:_}),"debrief"===s&&(0,a.jsx)(a.Fragment,{children:D?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:(0,a.jsx)("p",{className:"text-gray-600",children:"Generating your assessment..."})}):T?(0,a.jsx)(y,{scenario:t,assessment:T,viewMode:x,clickedTerms:A,savedTerms:L,onTermClick:O,onTermSave:_}):(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:(0,a.jsx)("p",{className:"text-gray-600",children:"No assessment available yet."})})})]})}}},function(e){e.O(0,[523,971,117,744],function(){return e(e.s=8297)}),_N_E=e.O()}]);